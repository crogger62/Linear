# Test Plan: LES-155 - Provide enumeration of issues

## Objective
Validate the CLI that enumerates Linear issues and returns counts grouped by
workflow state, with optional filters (assignee email, label, state, updated
since, include archived).

## Scope
- Script under test: `src/issuesFiltered.ts`
- CLI behaviors:
  - Enumerate issues for a user (viewer by default, or by `--email`)
  - Optional filters: `--label`, `--state`, `--since`, `--include-archived`
  - Group results by workflow state and print counts

## Out of scope
- Customer request export/analyzer flows
- UI/Express server endpoints

## Preconditions / Test data
- Node.js 18+ and dependencies installed (`npm install`)
- `.env` with a valid `LINEAR_API_KEY`
- Linear workspace with:
  - At least two users (for `--email` testing)
  - Issues across multiple workflow states
  - A mix of archived and non-archived issues
  - At least one label applied to some issues
  - Issues updated both within and outside a target window (e.g., 7 days)

## Test cases

### Functional
1. **Default enumeration (viewer)**
   - Steps:
     1) Run `npx ts-node src/issuesFiltered.ts`
   - Expected:
     - Output shows viewer info and filters (assignee = viewer)
     - Results table lists state counts
     - `Fetched` equals `Matched after filters` (no extra filters)
     - Counts match Linear UI for viewer-assigned, non-archived issues

2. **Enumerate by assignee email**
   - Steps:
     1) Run `npx ts-node src/issuesFiltered.ts --email "user@company.com"`
   - Expected:
     - Filters show the target email
     - Counts match that user's assigned, non-archived issues

3. **Filter by label (case-insensitive)**
   - Steps:
     1) Run `npx ts-node src/issuesFiltered.ts --label "Needs Triage"`
     2) Repeat with `--label "needs triage"`
   - Expected:
     - Only issues with that label are counted
     - Case differences do not change the result

4. **Filter by state (case-insensitive)**
   - Steps:
     1) Run `npx ts-node src/issuesFiltered.ts --state "In Progress"`
     2) Repeat with `--state "in progress"`
   - Expected:
     - Only issues in the specified state are counted
     - Case differences do not change the result

5. **Filter by updated-since window**
   - Steps:
     1) Run `npx ts-node src/issuesFiltered.ts --since 7`
   - Expected:
     - Only issues updated in the last 7 days are counted
     - Counts match Linear UI when filtered by updated date

6. **Include archived**
   - Steps:
     1) Run `npx ts-node src/issuesFiltered.ts`
     2) Run `npx ts-node src/issuesFiltered.ts --include-archived`
   - Expected:
     - Archived issues are excluded by default
     - Counts increase when `--include-archived` is set (if archived issues exist)

7. **Combined filters**
   - Steps:
     1) Run `npx ts-node src/issuesFiltered.ts --email "user@company.com" --label "Bug" --state "In Progress" --since 30`
   - Expected:
     - Only issues matching all filters are counted
     - `Matched after filters` reflects the intersection of criteria

8. **Pagination coverage**
   - Preconditions: Assignee has > 50 issues
   - Steps:
     1) Run `npx ts-node src/issuesFiltered.ts`
   - Expected:
     - All pages are processed
     - Totals match Linear UI (no missing issues)

### Edge cases
1. **No matches**
   - Steps:
     1) Run `npx ts-node src/issuesFiltered.ts --label "NonexistentLabel"`
   - Expected:
     - Results table prints only headers (no rows)
     - `Matched after filters` is 0

2. **Invalid/zero/negative `--since`**
   - Steps:
     1) Run `npx ts-node src/issuesFiltered.ts --since 0`
     2) Run `npx ts-node src/issuesFiltered.ts --since -5`
     3) Run `npx ts-node src/issuesFiltered.ts --since abc`
   - Expected:
     - The since filter is ignored
     - Results match baseline behavior

3. **Issues missing state**
   - Preconditions: At least one issue with missing/failed state relation
   - Steps:
     1) Run `npx ts-node src/issuesFiltered.ts`
   - Expected:
     - Such issues are counted under `(No State)`

### Error scenarios
1. **Missing API key**
   - Steps:
     1) Unset `LINEAR_API_KEY`
     2) Run `npx ts-node src/issuesFiltered.ts`
   - Expected:
     - Script exits with error: missing API key

2. **Unknown assignee email**
   - Steps:
     1) Run `npx ts-node src/issuesFiltered.ts --email "noone@company.com"`
   - Expected:
     - Script exits with error: no user found for email

3. **Linear API auth/network failure**
   - Steps:
     1) Use an invalid API key or block network access
   - Expected:
     - Script exits non-zero and prints the API error

## Integration points
- Linear API via `@linear/sdk` (users, issues, labels, workflow state)
- `.env` loading via `dotenv/config`
- CLI invocation via `ts-node`

## Performance considerations
- For large workspaces (1000+ issues), verify completion within an acceptable
  time budget (e.g., under 60 seconds on a typical dev machine).
- Label filtering triggers extra label fetches per issue; verify no rate-limit
  failures under typical loads.

