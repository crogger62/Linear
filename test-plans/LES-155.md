# Test Plan: LES-155 - Provide enumeration of issues

## Overview
Validate that the system can enumerate Linear issues for selection and downstream
processing. This covers the picker UI and API endpoint that list issues, including
pagination, search, and limits, as well as integration with the run flow that
uses issue IDs.

## In scope
- `GET /api/issues` in `src/customerRequests-server.ts`
- Issue list + search UI in `public/picker.html`
- Issue selection -> `/api/run` -> `src/customerRequests.ts --issue-id`

## Out of scope
- Customer request analysis (Python clustering, `insights.html`)
- Project enumeration (`GET /api/projects`)
- Issue creation or mutation flows

## Preconditions / test data
- Valid `LINEAR_API_KEY` in `.env` with read access.
- Workspace seeded with:
  - Multiple teams (e.g., ENG, OPS).
  - At least 1 issue per team with distinct titles.
  - At least 1 issue with an empty or very short title.
  - At least 1 archived issue.
  - A workspace with > 500 total issues (if available) to validate truncation.

## Functional test cases
| ID | Scenario | Steps | Expected |
|----|----------|-------|----------|
| F1 | List issues (default) | Start server, open `/api/issues` | JSON response with `issues` array, each item has `id`, `identifier`, `title`; count <= 200 |
| F2 | UI loads issues | Open `picker.html` | Issues list renders with radio rows; search input present |
| F3 | Search by identifier | `/api/issues?query=TEAM-123` | Only issue(s) for that team + number returned; identifiers match |
| F4 | Search by title | `/api/issues?query=login` | Only issues with title/identifier containing query (case-insensitive) |
| F5 | Search via UI | Type query in search box | Issue list updates to matching results |
| F6 | Limit respected | `/api/issues?limit=10` | Returned list length <= 10 |
| F7 | Selection feeds run | Select an issue, click "Analyze Customer Requests" | `/api/run` uses `type=issue` and `id`; logs show `--issue-id` |
| F8 | No matches | `/api/issues?query=NO-SUCH-ISSUE` | Empty `issues` array, no 500 error |

## Edge cases
- Query with leading/trailing whitespace is trimmed (e.g., `"  login  "`).
- Query looks like identifier but non-existent (e.g., `ENG-99999`) returns empty list.
- Mixed-case identifier (e.g., `eng-123`) resolves using uppercase team key.
- Issues with empty or null titles still return identifiers and are selectable.
- Workspace with > 500 issues: API stops after 500 fetched, returns `limit` subset.
- Duplicate issue numbers across teams: identifier search returns only matching team key.

## Error scenarios
- Missing or empty `LINEAR_API_KEY`: server fails fast; `/api/issues` not available.
- Invalid API key: `/api/issues` returns 500 with "Failed to fetch issues".
- Linear API/network failure mid-pagination: returns 500 and logs error.
- Invalid `limit` (non-numeric or negative): should clamp to a safe default (verify no crash).
- Client passes `limit=0` or `limit>500`: response length still within 1..500.

## Integration points
- Linear API: `issues` connection, pagination, filtering by team key + number.
- UI: `picker.html` fetches `/api/issues`, renders list, and submits selected `id`.
- Exporter: `/api/run` passes `--issue-id` into `src/customerRequests.ts`.

## Performance considerations
- `/api/issues` response time with 200 results < 2s on typical network.
- `/api/issues` response time with 500 results < 5s; no unbounded pagination.
- Rapid typing in UI search (multiple requests) does not crash server; last query wins.

